![导图](http://zanwenblog.oss-cn-beijing.aliyuncs.com/18-12-30/53535419.jpg)

## mysql索引
* B+Tree树: B+树是B-树的变体，也是一种多路搜索树
    - 非叶子结点的子树指针与关键字个数相同
    - 非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树(B-树是开区间）
    - 为所有叶子结点增加一个链指针
    - 所有关键字都在叶子结点出现
* 为什么B+Tree是多路搜索树
    - 假如一个表有上亿的数据，把整个树索引放入到内存，则可能要上G的内存，如果有10多张内存无法满足，所以使用
时间换空间角度考虑，索引数据存储到磁盘上，索引树高度等同于磁盘读取次数, 磁盘读写速度比内存慢得多，所以减少读写次数就能提高索引速度。
    - 不管内存、磁盘数据操作系统都是按照每页4K大小进行一次IO读写，索引大小最好是4K一页
    - 索引会使新增、删除数据变慢，因为：插入记录需要维护B+Tree树，为了保持每次获取索引4K大小，需要针对插入的记录对索引进行连锁更新

## mysql事物级别
* 事物级别
    - Read Uncommitted（读取未提交内容），在该隔离级别，所有事务都可以看到其他未提交事务的执行结果。本隔离级别很少用于实际应用，因为它的性能也不比其他级别好多少。读取未提交的数据，也被称之为脏读（Dirty Read）。
    - Read Committed（读取提交内容），定义：一个事务只能看见已经提交事务所做的改变
    - Repeatable Read（可重读）MySQL的默认事务隔离级别，它确保同一事务的多个实例在并发读取数据时，会看到同样的数据行
    - Serializable（可串行化），这是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突，从而解决幻读问题。简言之，它是在每个读的数据行上加上共享锁。在这个级别，可能导致大量的超时现象和锁竞争。
* innodb引擎的4大特性
    - 插入缓冲(insert buffer)；二次写(double write)；自适应哈希索引(ahi)；预读(read ahead)
* Mysql中的myisam与innodb的区别
    - 至少五点InooDB支持事务，而MyISAM不支持事务；
    - InnoDB支持行级锁，而MyISAM支持表级锁；
    - InnoDB支持MVCC，而MyISAM不支持；
    - InnoDB支持外键，而MyISAM不支持；
    - InnoDB不支持全文索引，而MyISAM支持；
    - InnoDB不能通过直接拷贝表文件的方法拷贝表到另外一台机器， myisam 支持；
    - InnoDB表支持多种行格式， myisam 不支持；
    - InnoDB是索引组织表， myisam 是堆表
* 数据库三大范式
    - 第一范式：数据库表中的字段都是单一属性的，不可再分(保持数据的原子性)；
    - 第二范式：第二范式必须符合第一范式，非主属性必须完全依赖于主键。
    - 第三范式：在满足第二范式的基础上，在实体中不存在其他实体中的非主键属性，传递函数依赖于主键属性，确保数据表中的每一列数据都和主键直接相关，而不能间接相关(表中字段[非主键]不存在对主键的传递依赖)
* varchar(100)和varchar(200)的区别答：varchar(100)最多存放100个字符，varchar(200)最多存放200个字符，varchar(100)和(200)存储hello所占空间一样，但后者在排序时会消耗更多内存，因为order by col采用fixed_length计算col长度(memory引擎也一样)
* union、union all的区别对重复结果的处理：UNION在进行表链接后会筛选掉重复的记录，Union All不会去除重复记录；对排序的处理：Union将会按照字段的顺序进行排序；UNION ALL只是简单的将两个结果合并后就返回；从效率上说，UNION ALL 要比UNION快很多
* varchar(20)和int(20)中的20含义一样吗答：不一样，前者表示最多存放20个字符，后者表示最多显示20个字符，但是存储空间还是占4字节存储，存储范围不变；
* 什么是存储过程？用什么来调用？答：存储过程是一个预编译的SQL 语句，优点是允许模块化的设计，就是说只需创建一次，以后在该程序中就可以调用多次。如果某次操作需要执行多次SQL ，使用存储过程比单纯SQL 语句执行要快。可以用一个命令对象来调用存储过程。
* 使用like 'a%' 、like'%a'、like'%a%'查询时是否会使用索引答：'a%'会，其他两个不会；
* 什么叫视图？游标是什么？视图是一种虚拟的表，具有和物理表相同的功能；可以对视图进行增，改，查，操作，视图通常是有一个表或者多个表的行或列的子集。对视图的修改不影响基本表。它使得我们获取数据更容易，相比多表查询。游标：是对查询出来的结果集作为一个单元来有效的处理。游标可以定在该单元中的特定行，从结果集的当前行检索一行或多行。可以对结果集当前行做修改。一般不使用游标，但是需要逐条处理数据的时候，游标显得十分重要。
* mysql有没有rowid？答：没有，InnoDB如果没有定义主键，内部会生成一个主键编号rowid ，但是无法查询到。在平时InnoDB建表的时候我们最好自己确定主键，防止每次插入数据前数据库会去生成rowid。


### 脚本

```sql
-- 查看当前运行的事务，这点在变更表结构之前必须要查看
select * from information_schema.innodb_trx;

-- 查看当前运行的事务的账户和事务开始的时间,及其事务语句
select
    a.id,a.user,a.host,b.trx_started,b.trx_query
from information_schema.processlist a right outer join information_schema.innodb_trx b
on a.id = b.trx_mysql_thread_id;
```

### mysql数据原则
* 原则：尽可能使用 not null
* 原则：尽可能选择小的数据类型和指定短的长度
* 原则：定长和非定长数据类型的选择
* 原则：字段注释要完整，见名知意
* 原则：单表字段不宜过多,二三十个就极限了
* 原则：可以预留字段


## Mysql的XA事务

```sql
XA RECOVER;
-- 开始事务
XA BEGIN '112345';
select * from stk_item;
XA END '112345';
-- 预提交
XA PREPARE '112345';
-- 提交事务
XA COMMIT '112345';
-- 回滚XA事务
XA ROLLBACK '112345';
```

## 常用命令
* 查看Mysql版本号

```
show variables like '%version%';
select version();
```
